<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C++ 3 march</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="процесс-компиляции-программ">Процесс компиляции программ</h1>
<div class="mermaid"><svg xmlns="http://www.w3.org/2000/svg" id="mermaid-svg-KaszADZDNwS694aX" height="100%" viewBox="0 0 514.8046875 626.625" style="max-width:514.8046875px;"><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M68.671875,66L68.671875,104L68.671875,142" marker-end="url(#arrowhead9647)" style="fill:none"></path><defs><marker id="arrowhead9647" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M68.671875,188L68.671875,226L68.671875,264" marker-end="url(#arrowhead9648)" style="fill:none"></path><defs><marker id="arrowhead9648" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M68.671875,310L68.671875,348L68.671875,386" marker-end="url(#arrowhead9649)" style="fill:none"></path><defs><marker id="arrowhead9649" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M177.3125,66L177.3125,104L177.3125,142" marker-end="url(#arrowhead9650)" style="fill:none"></path><defs><marker id="arrowhead9650" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M177.3125,188L177.3125,226L177.3125,264" marker-end="url(#arrowhead9651)" style="fill:none"></path><defs><marker id="arrowhead9651" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M177.3125,310L177.3125,348L177.3125,386" marker-end="url(#arrowhead9652)" style="fill:none"></path><defs><marker id="arrowhead9652" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M68.671875,432L68.671875,470L232.76642368321643,533.1859787458798" marker-end="url(#arrowhead9653)" style="fill:none"></path><defs><marker id="arrowhead9653" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M177.3125,432L177.3125,470L239.3375740198415,522.043423138914" marker-end="url(#arrowhead9654)" style="fill:none"></path><defs><marker id="arrowhead9654" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M269.453125,432L269.453125,470L269.453125,508" marker-end="url(#arrowhead9655)" style="fill:none"></path><defs><marker id="arrowhead9655" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M361.59375,432L361.59375,470L299.5686759801585,522.043423138914" marker-end="url(#arrowhead9656)" style="fill:none"></path><defs><marker id="arrowhead9656" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M453.734375,432L453.734375,470L305.7045573587231,532.1037423850295" marker-end="url(#arrowhead9657)" style="fill:none"></path><defs><marker id="arrowhead9657" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform="translate(68.671875,104)"><g transform="translate(-48.671875,-13)" class="label"><foreignObject width="97.34375" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">preprocessing</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(68.671875,226)"><g transform="translate(-37.4140625,-13)" class="label"><foreignObject width="74.828125" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">translation</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(68.671875,348)"><g transform="translate(-38.625,-13)" class="label"><foreignObject width="77.25" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">assembling</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform="translate(269.453125,470)"><g transform="translate(-22.8828125,-13)" class="label"><foreignObject width="45.765625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">linking</span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignObject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g class="node" style="opacity: 1;" id="a" transform="translate(68.671875,43)"><rect rx="5" ry="5" x="-29.3203125" y="-23" width="58.640625" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-19.3203125,-13)"><foreignObject width="38.640625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">1.cpp</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="b" transform="translate(68.671875,165)"><rect rx="5" ry="5" x="-18.453125" y="-23" width="36.90625" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-8.453125,-13)"><foreignObject width="16.90625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">1.i</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="c" transform="translate(68.671875,287)"><rect rx="5" ry="5" x="-19.9921875" y="-23" width="39.984375" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-9.9921875,-13)"><foreignObject width="19.984375" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">1.s</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="d" transform="translate(68.671875,409)"><rect rx="5" ry="5" x="-21.0703125" y="-23" width="42.140625" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-11.0703125,-13)"><foreignObject width="22.140625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">1.o</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="aa" transform="translate(177.3125,43)"><rect rx="5" ry="5" x="-29.3203125" y="-23" width="58.640625" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-19.3203125,-13)"><foreignObject width="38.640625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">2.cpp</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="bb" transform="translate(177.3125,165)"><rect rx="5" ry="5" x="-18.453125" y="-23" width="36.90625" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-8.453125,-13)"><foreignObject width="16.90625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">2.i</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="cc" transform="translate(177.3125,287)"><rect rx="5" ry="5" x="-19.9921875" y="-23" width="39.984375" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-9.9921875,-13)"><foreignObject width="19.984375" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">2.s</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="dd" transform="translate(177.3125,409)"><rect rx="5" ry="5" x="-21.0703125" y="-23" width="42.140625" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-11.0703125,-13)"><foreignObject width="22.140625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">2.o</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="result" transform="translate(269.453125,547.3125)"><circle x="-39.3125" y="-23" r="39.3125"></circle><g class="label" transform="translate(0,0)"><g transform="translate(-29.3125,-13)"><foreignObject width="58.625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">program</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="ddd" transform="translate(269.453125,409)"><rect rx="5" ry="5" x="-21.0703125" y="-23" width="42.140625" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-11.0703125,-13)"><foreignObject width="22.140625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">3.o</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="dddd" transform="translate(361.59375,409)"><rect rx="5" ry="5" x="-21.0703125" y="-23" width="42.140625" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-11.0703125,-13)"><foreignObject width="22.140625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">4.o</div></foreignObject></g></g></g><g class="node" style="opacity: 1;" id="ddddd" transform="translate(453.734375,409)"><rect rx="5" ry="5" x="-21.0703125" y="-23" width="42.140625" height="46"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-11.0703125,-13)"><foreignObject width="22.140625" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">5.o</div></foreignObject></g></g></g></g></g></g></svg></div>
<p>Исторически именно такая схема. На практике бывают “отхождения” - пропуски этапов (слияние в один этап)<br>
<strong>Preprocessing</strong><br>
<code>g++ -E -P 1.cpp -o 1.i</code><br>
В 1.cpp <code>#include&lt;stdio.h&gt; --&gt; typedef из stdio.h</code> а в конце <code>main</code><br>
<strong>Translation</strong><br>
<code>g++ -S -masm=intel 1.i -o 1.s</code><br>
<strong>Assembling</strong><br>
<code>g++ -C 1.s -o 1.o</code><br>
тут уже понадобится открыть бинарный файл: <code>xdd 1.o | less</code><br>
<strong>Linking</strong><br>
<code>g++ 1.o -o program</code><br>
После этого этапа запуск <code>./program</code> выведет Hello world!, например(если об этом программа)</p>
<p>По своей сути g++ - драйвер, который запускает этапы компиляции в нужном порядке и удаляет побочные файлы, конечно.</p>
<p>Примеры отхождений:</p>
<ul>
<li><em>preprocessing</em> и <em>translation</em> делает одна прога. Иногда в эту стадию включается assembling(clang)</li>
<li>1.o не всегда машинный код, только на linking он в него переходит</li>
</ul>
<p>Пример линкования файликов:</p>
<pre class=" language-c"><code class="prism ++ language-c">a<span class="token punctuation">.</span>cpp<span class="token punctuation">:</span>							b<span class="token punctuation">.</span>cpp<span class="token punctuation">:</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>					#include<span class="token operator">&lt;</span>cstdio<span class="token operator">&gt;</span>
	<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">prinf</span><span class="token punctuation">(</span><span class="token string">"Hell is here"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Это не скомпилится, тк на этапе до линковки компилятор не знает о существовании <code>f()</code> где то вне a.cpp, поэтому ее надо объявить:</p>
<pre class=" language-c"><code class="prism ++ language-c">a<span class="token punctuation">.</span>cpp<span class="token punctuation">:</span>							b<span class="token punctuation">.</span>cpp<span class="token punctuation">:</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>					#include<span class="token operator">&lt;</span>cstdio<span class="token operator">&gt;</span>
	<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">prinf</span><span class="token punctuation">(</span><span class="token string">"Hell is here"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Для линковки вместе:<br>
<code>g++ a.o b.o</code><br>
Если в обеих прогах есть main, то невозможно будет слинковать (какой main запускать?)</p>
<h3 id="headers">Headers</h3>
<p><code>2.h</code> - файлы не участвующие в компиляции, в них пишут объявления ф-ий. Нельзя <code>#include .cpp</code>, а в .h нельзя определять ф-ии<br>
(тут надо как то получше, у меня слишком сумбурные записи только)</p>
<h3 id="некоторые-ключевые-слова">Некоторые ключевые слова</h3>
<p>Иногда возникает проблема: при 1.i -&gt; 1.s компилятор не знает тела ф-ии и не может с оптимизировать код.</p>
<pre class=" language-c"><code class="prism ++ language-c"><span class="token number">1</span><span class="token punctuation">.</span>h<span class="token punctuation">:</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// - может инлайнить, а может и нет</span>
</code></pre>
<p><strong><code>inline</code></strong> значит что попадет и в a.cpp и в b.cpp -&gt; линковщик не будет ругаться, т.к. особый ключ <code>inline</code> - говорит компилятору: все копии одинаковые, оставь одну из них.</p>
<p><strong><code>static</code></strong> - ф-я локальна для единицы трансляции</p>
<p><strong><code>extern int a</code></strong> - переменная где-то (объявление)</p>
<p><strong><code>static a</code></strong> - локальная в ед.т.</p>
<p><strong><code>int a</code></strong> - определение переменной</p>
<blockquote>
<p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>
</div>
</body>

</html>
